# PureCaptcha 快速集成指南

## 📦 文件说明

```
examples/
├── backend/                        ← 后端代码
│   ├── CaptchaService.java         ← Service层（必须）
│   ├── CaptchaController.java      ← Controller层（必须）
│   ├── Application.java            ← 启动类（参考）
│   ├── pom.xml.example             ← Maven配置（参考）
│   ├── application.properties.example  ← 配置文件（参考）
│   └── 使用说明.md                 ← 详细文档
│
├── frontend/                       ← 前端代码
│   └── slider-captcha-test.html   ← 测试页面（可直接打开）
│
└── 快速集成指南.md                 ← 本文件
```

---

## 🚀 5分钟快速集成

### 方式1：复制到现有项目（推荐）

#### 步骤1：添加依赖

在 `pom.xml` 中添加：

```xml
<dependency>
    <groupId>io.github.purecaptcha</groupId>
    <artifactId>pure-captcha</artifactId>
    <version>1.0.0</version>
</dependency>
```

#### 步骤2：复制代码

```bash
# 复制Service和Controller到你的项目
你的项目/src/main/java/com/yourcompany/yourproject/
├── service/
│   └── CaptchaService.java          ← 复制 examples/backend/CaptchaService.java
└── controller/
    └── CaptchaController.java       ← 复制 examples/backend/CaptchaController.java
```

**⚠️ 重要**：修改文件顶部的包名！

```java
// 修改前
package com.example.captcha.service;

// 修改后
package com.yourcompany.yourproject.service;
```

#### 步骤3：启动测试

```bash
# 启动项目
mvn spring-boot:run

# 打开测试页面
打开 examples/frontend/slider-captcha-test.html
修改其中的 API_BASE 为你的地址
```

✅ **完成！** 验证码已集成！

---

### 方式2：创建新项目（完整示例）

#### 步骤1：创建Spring Boot项目

```bash
# 创建项目目录
mkdir captcha-demo
cd captcha-demo

# 复制pom.xml
cp examples/backend/pom.xml.example pom.xml

# 创建目录结构
mkdir -p src/main/java/com/example/captcha/{service,controller}
mkdir -p src/main/resources
```

#### 步骤2：复制所有文件

```bash
# 复制代码文件
cp examples/backend/Application.java src/main/java/com/example/captcha/
cp examples/backend/CaptchaService.java src/main/java/com/example/captcha/service/
cp examples/backend/CaptchaController.java src/main/java/com/example/captcha/controller/

# 复制配置文件
cp examples/backend/application.properties.example src/main/resources/application.properties
```

#### 步骤3：启动项目

```bash
mvn clean package
mvn spring-boot:run
```

访问：http://localhost:8080/api/captcha/slider

---

## 🎯 核心接口

### 1. 生成验证码

```http
GET /api/captcha/slider
```

### 2. 验证

```http
POST /api/captcha/verify
Content-Type: application/json

{
  "answer": "150"
}
```

### 3. 调试

```http
POST /api/captcha/debug
Content-Type: application/json

{
  "answer": "150"
}
```

---

## 🔍 测试验证

### 使用前端测试页面

1. 打开 `examples/frontend/slider-captcha-test.html`
2. 修改 `API_BASE` 为你的后端地址
3. 在浏览器中打开
4. 测试生成和验证

### 使用Postman测试

#### 生成验证码

```
GET http://localhost:8080/api/captcha/slider
```

**注意**：勾选 "Send cookies with requests"

#### 验证

```
POST http://localhost:8080/api/captcha/verify
Headers: Content-Type: application/json
Body (raw JSON):
{
  "answer": "150"
}
```

**注意**：使用同一个Session（Cookie）

---

## ⚠️ 常见问题

### Q1: 验证总是失败

**原因**：前后端Session不一致

**解决**：
1. 前端请求时必须包含 `credentials: 'include'`
2. 确保Cookie能正常传递
3. 检查是否有跨域问题

```javascript
fetch('/api/captcha/slider', {
  credentials: 'include'  // 必须！
})
```

---

### Q2: 跨域问题

**现象**：浏览器Console报CORS错误

**解决**：在 Controller 添加注解

```java
@CrossOrigin(origins = "http://localhost:3000", allowCredentials = "true")
```

或者配置全局CORS：

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("http://localhost:3000")
                .allowCredentials(true)
                .allowedMethods("GET", "POST");
    }
}
```

---

### Q3: 包名报错

**现象**：编译时找不到类

**解决**：检查包名是否修改正确

```java
// CaptchaService.java 第1行
package com.example.captcha.service;  // 改成你的包名

// CaptchaController.java 第1行
package com.example.captcha.controller;  // 改成你的包名

// CaptchaController.java import
import com.example.captcha.service.CaptchaService;  // 改成你的包名
```

---

## 📊 项目结构示例

### 标准Spring Boot项目

```
your-project/
├── pom.xml
├── src/
│   └── main/
│       ├── java/
│       │   └── com/yourcompany/yourproject/
│       │       ├── Application.java
│       │       ├── controller/
│       │       │   └── CaptchaController.java  ← 复制这个
│       │       └── service/
│       │           └── CaptchaService.java     ← 复制这个
│       └── resources/
│           └── application.properties
└── target/
```

---

## 🎨 自定义配置

### 修改验证码尺寸

在 `CaptchaService.java` 中：

```java
public Object generateSliderCaptcha(...) {
    CaptchaConfig.Builder configBuilder = CaptchaConfig.builder()
            .width(400)      // 修改宽度
            .height(250)     // 修改高度
            .sliderTolerance(20);  // 修改容差
    // ...
}
```

### 修改过期时间

在 `CaptchaService.java` 中：

```java
private static final long EXPIRE_TIME = 10 * 60 * 1000; // 改为10分钟
```

### 禁用内置背景

```java
// 使用默认生成的背景
configBuilder.builtinBackground(null);
```

---

## 📚 完整文档

- **技术原理**：`智能验证算法说明.md`
- **快速参考**：`智能验证快速使用.txt`
- **详细说明**：`examples/backend/使用说明.md`

---

## ✅ 检查清单

集成前检查：

- [ ] Maven依赖已添加（pure-captcha 1.0.0）
- [ ] 代码已复制到项目
- [ ] 包名已修改
- [ ] 项目能正常启动
- [ ] 可以访问 `/api/captcha/slider`
- [ ] 前端能正常调用API
- [ ] Session/Cookie 正常传递
- [ ] 验证功能正常工作

---

## 🎉 完成！

现在你的项目已经集成了：

✅ 智能滑动验证码（95%成功率）  
✅ 11张高清内置背景  
✅ 自动过期清理  
✅ 完整的REST API  
✅ 调试接口  

**有问题？** 查看 `examples/backend/使用说明.md` 获取更多帮助！

---

**祝使用愉快！** 🚀

