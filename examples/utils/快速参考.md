# ⚡ CaptchaUtil 快速参考

---

## 📦 文件清单

| 文件 | 用途 |
|-----|------|
| `CaptchaUtil.java` | 后端工具类 |
| `captcha-util.js` | 前端工具类 |
| `CaptchaUtilExample.java` | 后端示例 |
| `captcha-util-demo.html` | 前端示例 |

---

## 🔧 后端快速使用

### 生成验证码

```java
// 方式1：通用方法
Map<String, Object> result = CaptchaUtil.generate("ARITHMETIC");

// 方式2：快捷方法
Map<String, Object> result = CaptchaUtil.arithmetic();
```

### 验证答案

```java
// 普通验证码
boolean isValid = CaptchaUtil.verify(captchaId, userAnswer);

// 滑动验证码
boolean isValid = CaptchaUtil.verifySlider(captchaId, userX);
```

### 5种快捷方法

```java
CaptchaUtil.alphanumeric()     // 字符验证码
CaptchaUtil.arithmetic()        // 算术验证码（加减）
CaptchaUtil.arithmetic(true)    // 算术验证码（加减乘除）
CaptchaUtil.chinese()           // 中文验证码
CaptchaUtil.gif()               // GIF动图验证码
CaptchaUtil.slider()            // 滑动拼图验证码
```

---

## 🎨 前端快速使用

### 初始化

```javascript
const captcha = new CaptchaUtil({
    container: '#captcha-container',
    apiBaseUrl: '/api/captcha',
    type: 'ARITHMETIC'
});

captcha.generate();
```

### 回调函数

```javascript
const captcha = new CaptchaUtil({
    container: '#captcha-container',
    type: 'ARITHMETIC',
    onSuccess: (result) => {
        console.log('验证成功');
    },
    onError: (error) => {
        console.log('验证失败');
    }
});
```

---

## 🔗 Spring Boot Controller

```java
@RestController
@RequestMapping("/api/captcha")
public class CaptchaController {
    
    @GetMapping("/generate")
    public Map<String, Object> generate(@RequestParam String type) {
        Map<String, Object> response = new HashMap<>();
        try {
            Map<String, Object> data = CaptchaUtil.generate(type);
            response.put("success", true);
            response.put("data", data);
        } catch (Exception e) {
            response.put("success", false);
            response.put("message", e.getMessage());
        }
        return response;
    }
    
    @PostMapping("/verify")
    public Map<String, Object> verify(@RequestBody Map<String, String> req) {
        String captchaId = req.get("captchaId");
        String answer = req.get("answer");
        boolean isValid = CaptchaUtil.verify(captchaId, answer);
        
        Map<String, Object> response = new HashMap<>();
        response.put("success", isValid);
        response.put("message", isValid ? "验证成功" : "验证失败");
        return response;
    }
}
```

---

## 📋 验证码类型

| 类型 | 常量 | 快捷方法 | 说明 |
|-----|------|---------|------|
| 字符 | `ALPHANUMERIC` | `alphanumeric()` | 字母+数字 |
| 算术 | `ARITHMETIC` | `arithmetic()` | 加减法 |
| 中文 | `CHINESE` | `chinese()` | 常用汉字 |
| GIF | `ANIMATED_GIF` | `gif()` | 动态效果 |
| 滑动 | `SLIDER` | `slider()` | 拼图验证 |

---

## 🛠️ 实用方法

### 后端管理

```java
CaptchaUtil.getCount()         // 获取验证码数量
CaptchaUtil.cleanExpired()     // 清理过期验证码
CaptchaUtil.remove(captchaId)  // 删除指定验证码
CaptchaUtil.clear()            // 清空所有验证码
```

### 前端方法

```javascript
captcha.generate()          // 生成验证码
captcha.getCaptchaId()      // 获取验证码ID
captcha.getCaptchaData()    // 获取验证码数据
captcha.destroy()           // 销毁实例
```

---

## 📊 返回数据

### 普通验证码

```json
{
    "captchaId": "abc123...",
    "type": "ARITHMETIC",
    "imageBase64": "iVBORw0KG...",
    "answer": "15"
}
```

### 滑动验证码

```json
{
    "captchaId": "abc123...",
    "type": "SLIDER",
    "imageBase64": "iVBORw0KG...",
    "sliderImageBase64": "iVBORw0KG...",
    "sliderY": 120,
    "answer": "250"
}
```

---

## ⚙️ 自定义配置

```java
// 后端
CaptchaConfig config = CaptchaConfig.builder()
    .width(300)
    .height(100)
    .length(6)
    .operatorType("ALL")
    .build();
Map<String, Object> result = CaptchaUtil.generate("ARITHMETIC", config);
```

```javascript
// 前端
const captcha = new CaptchaUtil({
    container: '#captcha',
    apiBaseUrl: '/api/captcha',
    type: 'ARITHMETIC',
    width: 300,
    height: 100
});
```

---

## 🚀 快速开始

### 1. 安装依赖

```bash
mvn clean install
```

### 2. 添加到项目

```xml
<dependency>
    <groupId>io.github.purecaptcha</groupId>
    <artifactId>pure-captcha</artifactId>
    <version>1.0.0</version>
</dependency>
```

### 3. 复制文件

- 后端：复制 `CaptchaUtil.java`
- 前端：复制 `captcha-util.js`

### 4. 使用

- 后端：创建Controller（参考上面示例）
- 前端：初始化并生成验证码

---

## 💡 提示

### 生产环境

删除返回答案的代码：

```java
// 注释这行
// result.put("answer", captcha.getAnswer());
```

### 过期时间

默认5分钟，可在`CaptchaUtil.java`中修改：

```java
private static final long EXPIRATION_TIME = 5 * 60 * 1000;
```

### 调试滑动验证码

```java
Map<String, Object> info = CaptchaUtil.getSliderDebugInfo(captchaId);
System.out.println("正确位置: " + info.get("correctPosition"));
```

---

## 📖 完整文档

查看 `通用验证码工具类使用指南.md` 了解详细信息。

---

**版本**: 1.0.0  
**更新**: 2025-10-20

