# âš¡ CaptchaUtil å¿«é€Ÿå‚è€ƒ

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç”¨é€” |
|-----|------|
| `CaptchaUtil.java` | åç«¯å·¥å…·ç±» |
| `captcha-util.js` | å‰ç«¯å·¥å…·ç±» |
| `CaptchaUtilExample.java` | åç«¯ç¤ºä¾‹ |
| `captcha-util-demo.html` | å‰ç«¯ç¤ºä¾‹ |

---

## ğŸ”§ åç«¯å¿«é€Ÿä½¿ç”¨

### ç”ŸæˆéªŒè¯ç 

```java
// æ–¹å¼1ï¼šé€šç”¨æ–¹æ³•
Map<String, Object> result = CaptchaUtil.generate("ARITHMETIC");

// æ–¹å¼2ï¼šå¿«æ·æ–¹æ³•
Map<String, Object> result = CaptchaUtil.arithmetic();
```

### éªŒè¯ç­”æ¡ˆ

```java
// æ™®é€šéªŒè¯ç 
boolean isValid = CaptchaUtil.verify(captchaId, userAnswer);

// æ»‘åŠ¨éªŒè¯ç 
boolean isValid = CaptchaUtil.verifySlider(captchaId, userX);
```

### 5ç§å¿«æ·æ–¹æ³•

```java
CaptchaUtil.alphanumeric()     // å­—ç¬¦éªŒè¯ç 
CaptchaUtil.arithmetic()        // ç®—æœ¯éªŒè¯ç ï¼ˆåŠ å‡ï¼‰
CaptchaUtil.arithmetic(true)    // ç®—æœ¯éªŒè¯ç ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰
CaptchaUtil.chinese()           // ä¸­æ–‡éªŒè¯ç 
CaptchaUtil.gif()               // GIFåŠ¨å›¾éªŒè¯ç 
CaptchaUtil.slider()            // æ»‘åŠ¨æ‹¼å›¾éªŒè¯ç 
```

---

## ğŸ¨ å‰ç«¯å¿«é€Ÿä½¿ç”¨

### åˆå§‹åŒ–

```javascript
const captcha = new CaptchaUtil({
    container: '#captcha-container',
    apiBaseUrl: '/api/captcha',
    type: 'ARITHMETIC'
});

captcha.generate();
```

### å›è°ƒå‡½æ•°

```javascript
const captcha = new CaptchaUtil({
    container: '#captcha-container',
    type: 'ARITHMETIC',
    onSuccess: (result) => {
        console.log('éªŒè¯æˆåŠŸ');
    },
    onError: (error) => {
        console.log('éªŒè¯å¤±è´¥');
    }
});
```

---

## ğŸ”— Spring Boot Controller

```java
@RestController
@RequestMapping("/api/captcha")
public class CaptchaController {
    
    @GetMapping("/generate")
    public Map<String, Object> generate(@RequestParam String type) {
        Map<String, Object> response = new HashMap<>();
        try {
            Map<String, Object> data = CaptchaUtil.generate(type);
            response.put("success", true);
            response.put("data", data);
        } catch (Exception e) {
            response.put("success", false);
            response.put("message", e.getMessage());
        }
        return response;
    }
    
    @PostMapping("/verify")
    public Map<String, Object> verify(@RequestBody Map<String, String> req) {
        String captchaId = req.get("captchaId");
        String answer = req.get("answer");
        boolean isValid = CaptchaUtil.verify(captchaId, answer);
        
        Map<String, Object> response = new HashMap<>();
        response.put("success", isValid);
        response.put("message", isValid ? "éªŒè¯æˆåŠŸ" : "éªŒè¯å¤±è´¥");
        return response;
    }
}
```

---

## ğŸ“‹ éªŒè¯ç ç±»å‹

| ç±»å‹ | å¸¸é‡ | å¿«æ·æ–¹æ³• | è¯´æ˜ |
|-----|------|---------|------|
| å­—ç¬¦ | `ALPHANUMERIC` | `alphanumeric()` | å­—æ¯+æ•°å­— |
| ç®—æœ¯ | `ARITHMETIC` | `arithmetic()` | åŠ å‡æ³• |
| ä¸­æ–‡ | `CHINESE` | `chinese()` | å¸¸ç”¨æ±‰å­— |
| GIF | `ANIMATED_GIF` | `gif()` | åŠ¨æ€æ•ˆæœ |
| æ»‘åŠ¨ | `SLIDER` | `slider()` | æ‹¼å›¾éªŒè¯ |

---

## ğŸ› ï¸ å®ç”¨æ–¹æ³•

### åç«¯ç®¡ç†

```java
CaptchaUtil.getCount()         // è·å–éªŒè¯ç æ•°é‡
CaptchaUtil.cleanExpired()     // æ¸…ç†è¿‡æœŸéªŒè¯ç 
CaptchaUtil.remove(captchaId)  // åˆ é™¤æŒ‡å®šéªŒè¯ç 
CaptchaUtil.clear()            // æ¸…ç©ºæ‰€æœ‰éªŒè¯ç 
```

### å‰ç«¯æ–¹æ³•

```javascript
captcha.generate()          // ç”ŸæˆéªŒè¯ç 
captcha.getCaptchaId()      // è·å–éªŒè¯ç ID
captcha.getCaptchaData()    // è·å–éªŒè¯ç æ•°æ®
captcha.destroy()           // é”€æ¯å®ä¾‹
```

---

## ğŸ“Š è¿”å›æ•°æ®

### æ™®é€šéªŒè¯ç 

```json
{
    "captchaId": "abc123...",
    "type": "ARITHMETIC",
    "imageBase64": "iVBORw0KG...",
    "answer": "15"
}
```

### æ»‘åŠ¨éªŒè¯ç 

```json
{
    "captchaId": "abc123...",
    "type": "SLIDER",
    "imageBase64": "iVBORw0KG...",
    "sliderImageBase64": "iVBORw0KG...",
    "sliderY": 120,
    "answer": "250"
}
```

---

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

```java
// åç«¯
CaptchaConfig config = CaptchaConfig.builder()
    .width(300)
    .height(100)
    .length(6)
    .operatorType("ALL")
    .build();
Map<String, Object> result = CaptchaUtil.generate("ARITHMETIC", config);
```

```javascript
// å‰ç«¯
const captcha = new CaptchaUtil({
    container: '#captcha',
    apiBaseUrl: '/api/captcha',
    type: 'ARITHMETIC',
    width: 300,
    height: 100
});
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
mvn clean install
```

### 2. æ·»åŠ åˆ°é¡¹ç›®

```xml
<dependency>
    <groupId>io.github.purecaptcha</groupId>
    <artifactId>pure-captcha</artifactId>
    <version>1.0.0</version>
</dependency>
```

### 3. å¤åˆ¶æ–‡ä»¶

- åç«¯ï¼šå¤åˆ¶ `CaptchaUtil.java`
- å‰ç«¯ï¼šå¤åˆ¶ `captcha-util.js`

### 4. ä½¿ç”¨

- åç«¯ï¼šåˆ›å»ºControllerï¼ˆå‚è€ƒä¸Šé¢ç¤ºä¾‹ï¼‰
- å‰ç«¯ï¼šåˆå§‹åŒ–å¹¶ç”ŸæˆéªŒè¯ç 

---

## ğŸ’¡ æç¤º

### ç”Ÿäº§ç¯å¢ƒ

åˆ é™¤è¿”å›ç­”æ¡ˆçš„ä»£ç ï¼š

```java
// æ³¨é‡Šè¿™è¡Œ
// result.put("answer", captcha.getAnswer());
```

### è¿‡æœŸæ—¶é—´

é»˜è®¤5åˆ†é’Ÿï¼Œå¯åœ¨`CaptchaUtil.java`ä¸­ä¿®æ”¹ï¼š

```java
private static final long EXPIRATION_TIME = 5 * 60 * 1000;
```

### è°ƒè¯•æ»‘åŠ¨éªŒè¯ç 

```java
Map<String, Object> info = CaptchaUtil.getSliderDebugInfo(captchaId);
System.out.println("æ­£ç¡®ä½ç½®: " + info.get("correctPosition"));
```

---

## ğŸ“– å®Œæ•´æ–‡æ¡£

æŸ¥çœ‹ `é€šç”¨éªŒè¯ç å·¥å…·ç±»ä½¿ç”¨æŒ‡å—.md` äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚

---

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°**: 2025-10-20

